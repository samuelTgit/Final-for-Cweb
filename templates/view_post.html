{% extends "base.html" %}

{% block title %}{{ legend }}{{ post.title }}Blog{% endblock %}



    {% block content %}

    <h2>Current Posts</h2>
        <div>
            <h3>Title: {{ post.title }}</h3>
            <p>
                By {{ post.author.username }}
                    Post {{ post.created_at.strftime('%B %d, %Y at %I:%M %p') }}
                {% if post.updated_at != post.created_at %}
                        Updated {{ post.updated_at.strftime('%B %d, %Y at %I:%M %p') }}
                {% endif %}
            </p>
            <hr>
            <div class="content">
                
                {{ post.content|replace('\n', '<br>')|safe }}
                <br>
            </div>
        </div>
        {% if current_user.is_authenticated and current_user == post.author %}
        <div>
            <a href="{{ url_for('edit_post', post_id=post.id) }}">
               <button type="button" class="btn btn-warning">Edit</button> 
            </a>
            <br>
            <form method="POST" action="{{ url_for('delete_post', post_id=post.id) }}" >
                {{ form.hidden_tag() if form is defined }}
                <button class="btn btn-danger"type="submit" onclick="return confirm('Are you sure you want to delete this post?');">Delete</button>
            </form>
        </div>
        {% endif %}


        <hr>
        <div>
            <h3>Comments</h3>
            {% if post.comments %}
                {% for c in post.comments %}
                    <div>
                        <strong>{{ c.author.username }}</strong>
                        <small>{{ c.created_at.strftime('%B %d, %Y at %I:%M %p') }}</small>
                        <p>{{ c.content | replace('\n', '<br>') | safe }}</p>
                    </div>
                {% endfor %}
            {% else %}
                <p>No comments yet.</p>
            {% endif %}
        </div>

        {% if current_user.is_authenticated and current_user != post.author %}
        <div>
            <h4>Add a comment</h4>
            <form method="POST" action="{{ url_for('add_comment', post_id=post.id) }}">
                {{ form.hidden_tag() }}
                <div>
                    {{ form.content.label }}
                    {{ form.content(rows=3) }}
                    {% for error in form.content.errors %}
                        <div><span>{{ error }}</span></div>
                    {% endfor %}
                </div>
                <div>
                    {{ form.submit() }}
                </div>
            </form>
        </div>
        {% elif not current_user.is_authenticated %}
            <a href="{{ url_for('login') }}">Login</a> to comment.
        {% endif %}


        <div>
        <a href="{{ url_for('index') }}"><button type="button" class="btn btn-primary">Back to Blog</button></a>
        </div>
    {% endblock %}